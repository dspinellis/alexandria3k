
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Common utility functions &#8212; alexandria3k 2.5.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Debug logging" href="debug.html" />
    <link rel="prev" title="Python utility API" href="utility-api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="common-utility-functions">
<h1>Common utility functions<a class="headerlink" href="#common-utility-functions" title="Permalink to this headline">¶</a></h1>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">alexandria3k</span> <span class="kn">import</span> <span class="n">common</span>
</pre></div>
</div>
<span class="target" id="module-common"></span><p>Functions common to multiple modules</p>
<dl class="py function">
<dt class="sig sig-object py" id="common.data_from_uri_provider">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">data_from_uri_provider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.data_from_uri_provider" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a file path, a URL, or this package’s resource path
return a readable source for its contents.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source</strong> (<em>str</em>) – A file path, a URL, or an internal data source starting
with <cite>resource:</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.ensure_table_exists">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">ensure_table_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">connection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.ensure_table_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Terminate the program with an error message if the specified table
does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>connection</strong> (<em>Connection</em>) – The database connection to use for checking the
table’s existence.</p></li>
<li><p><strong>table_name</strong> (<em>str</em>) – The table to check for existence.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.ensure_unlinked">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">ensure_unlinked</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.ensure_unlinked" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensure that the file at the specified path does not exist
by unlinking it, if needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>str</em>) – Path to the file that must not exist.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.fail">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">fail</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.fail" title="Permalink to this definition">¶</a></dt>
<dd><p>Output an error message on the standard error stream with the specified
message.
Terminate the program’s execution with an exit code of 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> (<em>str</em>) – The message to output.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.get_string_resource">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">get_string_resource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.get_string_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the contents of the named file relative to the package’s
source code directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>str</em>) – The file’s file path relative to the <cite>src/alexandria3k</cite>
directory.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.is_unittest">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">is_unittest</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#common.is_unittest" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if the routine is executed in a unit test.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.is_url">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">is_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.is_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if url looks like a URL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>url</strong> (<em>str</em>) – The URL to match</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.log_sql">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">log_sql</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.log_sql" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the specified SQL statement. If the debug “sql” value
is set, output a copy of the statement on the standard output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>statement</strong> (<em>str</em>) – The statement that will be executed.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.program_version">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">program_version</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#common.program_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a string identifying the program’s version.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.query_result">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">query_result</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.query_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the result of executing the specified query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cursor</strong> (<em>Cursor</em>) – Database cursor to use for executing the query.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – The query to execute.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.remove_sqlite_comments">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">remove_sqlite_comments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">script</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.remove_sqlite_comments" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove SQLite comments (– and C-style) from the passed script.
This cannot handle comment characters embedded in strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>script</strong> (<em>str</em>) – An SQL script, possibly multi-line, possibly containing
C-style block comments (<cite>/* … */</cite>).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.set_fast_writing">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">set_fast_writing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">connection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'main'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.set_fast_writing" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement very fast database inserts at the risk of possible data
corruption in case of a crash.
We don’t really care, because we assume the database is
populated in one go from empty, and if it gets corrupted
the process can be repeated.
This increases speed in ORCID works population by 50:
from 845291 / 2 records in 16980 s (40 ms / record) to
3225659 / 2 records in 1292 s (800 μs / record).
It also reduces the time required to run the Crossref tests from 994 ms
to 372 ms.
See <a class="reference external" href="https://stackoverflow.com/a/58547438/20520">https://stackoverflow.com/a/58547438/20520</a> for measurements behind this
approach.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>connection</strong> (<em>Connection</em>) – Connection to the database to configure.</p></li>
<li><p><strong>name</strong> (<em>str</em><em>, </em><em>optional</em>) – Name of the database to configure.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.table_exists">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">table_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.table_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if the specified database table exists.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cursor</strong> (<em>Cursor</em>) – Database cursor to use for executing the required query.</p></li>
<li><p><strong>table_name</strong> (<em>str</em>) – The table to check for existence.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.try_sql_execute">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">try_sql_execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execution_context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statement</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.try_sql_execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the result of executing the specified SQL statement.
The statement is logged through log_sql. If the satement’s
execution fails the program terminates with the failure’s error message.
output a copy of the statement on the standard output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>execution_context</strong> – The context in which the execute method will
be called to evaluate the statement.</p></li>
<li><p><strong>statement</strong> (<em>str</em>) – The statement that will be executed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.warn">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">warn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.warn" title="Permalink to this definition">¶</a></dt>
<dd><p>Output a warning on the standard error stream with the specified message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> (<em>str</em>) – The message to output.</p>
</dd>
</dl>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">alexandria3k</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading.html">Data downloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="use.html">Use overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli-eg.html">Command line examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-eg.html">Python API examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="app-eg.html">Application examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema.html">Schema diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-api.html">Python user API</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin-api.html">Python plugin API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="utility-api.html">Python utility API</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Common utility functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug.html">Debug logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf.html">Performance monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Development processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-plugin.html">Plugin development</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ: Frequently asked questions</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="utility-api.html">Python utility API</a><ul>
      <li>Previous: <a href="utility-api.html" title="previous chapter">Python utility API</a></li>
      <li>Next: <a href="debug.html" title="next chapter">Debug logging</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022-2023, Diomidis Spinellis.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/common.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>