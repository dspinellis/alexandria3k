<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Common utility functions &#8212; alexandria3k 3.6.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5349f462"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Debug logging" href="debug.html" />
    <link rel="prev" title="Python utility API" href="utility-api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="common-utility-functions">
<h1>Common utility functions<a class="headerlink" href="#common-utility-functions" title="Link to this heading">¶</a></h1>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">alexandria3k</span><span class="w"> </span><span class="kn">import</span> <span class="n">common</span>
</pre></div>
</div>
<p id="module-common">Functionality common to multiple modules</p>
<dl class="py exception">
<dt class="sig sig-object py" id="common.Alexandria3kError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">Alexandria3kError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.Alexandria3kError" title="Link to this definition">¶</a></dt>
<dd><p>An exception raised by errors detected by the Alexandria3k API.
These errors are caught by the CLI and displayed only through their
message.  API clients might want to catch these errors and report
them in a friendly manner.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="common.Alexandria3kInternalError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">Alexandria3kInternalError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.Alexandria3kInternalError" title="Link to this definition">¶</a></dt>
<dd><p>An exception raised by internal errors detected by the Alexandria3k
API.  These errors are propagated to the top level and are not caught
by the CLI, thus resulting in a reportable stack trace.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.data_from_uri_provider">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">data_from_uri_provider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.data_from_uri_provider" title="Link to this definition">¶</a></dt>
<dd><p>Given a file path, a URL, or this package’s resource path
return a readable source for its contents.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>source</strong> (<em>str</em>) – A file path, a URL, or an internal data source starting
with <cite>resource:</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.ensure_table_exists">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">ensure_table_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">connection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.ensure_table_exists" title="Link to this definition">¶</a></dt>
<dd><p>Terminate the program with an error message if the specified table
does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>connection</strong> (<em>Connection</em>) – The database connection to use for checking the
table’s existence.</p></li>
<li><p><strong>table_name</strong> (<em>str</em>) – The table to check for existence.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.ensure_unlinked">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">ensure_unlinked</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.ensure_unlinked" title="Link to this definition">¶</a></dt>
<dd><p>Ensure that the file at the specified path does not exist
by unlinking it, if needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>str</em>) – Path to the file that must not exist.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.get_string_resource">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">get_string_resource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.get_string_resource" title="Link to this definition">¶</a></dt>
<dd><p>Return the contents of the named file relative to the package’s
source code directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>str</em>) – The file’s file path relative to the <cite>src/alexandria3k</cite>
directory.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.is_unittest">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">is_unittest</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#common.is_unittest" title="Link to this definition">¶</a></dt>
<dd><p>Return True if the routine is executed in a unit test.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.is_url">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">is_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.is_url" title="Link to this definition">¶</a></dt>
<dd><p>Return true if url looks like a URL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>url</strong> (<em>str</em>) – The URL to match</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.log_sql">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">log_sql</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.log_sql" title="Link to this definition">¶</a></dt>
<dd><p>Return the specified SQL statement. If the debug “sql” value
is set, output a copy of the statement on the standard output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>statement</strong> (<em>str</em>) – The statement that will be executed.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.program_version">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">program_version</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#common.program_version" title="Link to this definition">¶</a></dt>
<dd><p>Return a string identifying the program’s version.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.query_result">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">query_result</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.query_result" title="Link to this definition">¶</a></dt>
<dd><p>Return the result of executing the specified query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cursor</strong> (<em>Cursor</em>) – Database cursor to use for executing the query.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – The query to execute.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.remove_sqlite_comments">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">remove_sqlite_comments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">script</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.remove_sqlite_comments" title="Link to this definition">¶</a></dt>
<dd><p>Remove SQLite comments (– and C-style) from the passed script.
This cannot handle comment characters embedded in strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>script</strong> (<em>str</em>) – An SQL script, possibly multi-line, possibly containing
C-style block comments (<cite>/* … */</cite>).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.set_fast_writing">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">set_fast_writing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">connection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'main'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.set_fast_writing" title="Link to this definition">¶</a></dt>
<dd><p>Implement very fast database inserts at the risk of possible data
corruption in case of a crash.
We don’t really care, because we assume the database is
populated in one go from empty, and if it gets corrupted
the process can be repeated.
This increases speed in ORCID works population by 50:
from 845291 / 2 records in 16980 s (40 ms / record) to
3225659 / 2 records in 1292 s (800 μs / record).
It also reduces the time required to run the Crossref tests from 994 ms
to 372 ms.
See <a class="reference external" href="https://stackoverflow.com/a/58547438/20520">https://stackoverflow.com/a/58547438/20520</a> for measurements behind this
approach.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>connection</strong> (<em>Connection</em>) – Connection to the database to configure.</p></li>
<li><p><strong>name</strong> (<em>str</em><em>, </em><em>optional</em>) – Name of the database to configure.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.table_exists">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">table_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.table_exists" title="Link to this definition">¶</a></dt>
<dd><p>Return True if the specified database table exists.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cursor</strong> (<em>Cursor</em>) – Database cursor to use for executing the required query.</p></li>
<li><p><strong>table_name</strong> (<em>str</em>) – The table to check for existence.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.try_sql_execute">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">try_sql_execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">execution_context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statement</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.try_sql_execute" title="Link to this definition">¶</a></dt>
<dd><p>Return the result of executing the specified SQL statement.
The statement is logged through log_sql. If the satement’s
execution fails the program terminates with the failure’s error message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>execution_context</strong> – The context in which the execute method will
be called to evaluate the statement.</p></li>
<li><p><strong>statement</strong> (<em>str</em>) – The statement that will be executed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="common.warn">
<span class="sig-prename descclassname"><span class="pre">common.</span></span><span class="sig-name descname"><span class="pre">warn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#common.warn" title="Link to this definition">¶</a></dt>
<dd><p>Output a warning on the standard error stream with the specified message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>message</strong> (<em>str</em>) – The message to output.</p>
</dd>
</dl>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">alexandria3k</a></h1>



<p class="blurb">Local relational access to openly-available publication data sets</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=dspinellis&repo=alexandria3k&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading.html">Data downloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="use.html">Use overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli-eg.html">Command line examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-eg.html">Python API examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="app-eg.html">Application examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema.html">Schema diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-api.html">Python user API</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin-api.html">Python plugin API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="utility-api.html">Python utility API</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Common utility functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug.html">Debug logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf.html">Performance monitoring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Development processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-plugin.html">Plugin development</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ: Frequently asked questions</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="None">Version: 3.6.0</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="utility-api.html">Python utility API</a><ul>
      <li>Previous: <a href="utility-api.html" title="previous chapter">Python utility API</a></li>
      <li>Next: <a href="debug.html" title="next chapter">Debug logging</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022-2025, Diomidis Spinellis.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/common.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>